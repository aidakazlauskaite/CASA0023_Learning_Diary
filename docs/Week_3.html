<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CASA0023 Learning Diary - 3&nbsp; Corrections</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Week_4.html" rel="next">
<link href="./Week_2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Week_3.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Corrections</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">CASA0023 Learning Diary</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Remote Sensing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Xarigan</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week_3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Corrections</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Policy</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Google Earth Engine</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Classification I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week_7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Classification II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week_8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Temperature</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary"><span class="header-section-number">3.1</span> Summary</a>
  <ul class="collapse">
  <li><a href="#geometric-correction" id="toc-geometric-correction" class="nav-link" data-scroll-target="#geometric-correction"><span class="header-section-number">3.1.1</span> Geometric correction</a></li>
  <li><a href="#atmospheric-correction" id="toc-atmospheric-correction" class="nav-link" data-scroll-target="#atmospheric-correction"><span class="header-section-number">3.1.2</span> Atmospheric correction</a></li>
  <li><a href="#orthorectificationtopographic-correction" id="toc-orthorectificationtopographic-correction" class="nav-link" data-scroll-target="#orthorectificationtopographic-correction"><span class="header-section-number">3.1.3</span> Orthorectification/topographic correction</a></li>
  <li><a href="#radiometric-calibration" id="toc-radiometric-calibration" class="nav-link" data-scroll-target="#radiometric-calibration"><span class="header-section-number">3.1.4</span> Radiometric calibration</a></li>
  <li><a href="#disclaimer---or-simply-good-news" id="toc-disclaimer---or-simply-good-news" class="nav-link" data-scroll-target="#disclaimer---or-simply-good-news"><span class="header-section-number">3.1.5</span> Disclaimer - or simply good news?</a></li>
  </ul></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications"><span class="header-section-number">3.2</span> Applications</a>
  <ul class="collapse">
  <li><a href="#geometric-correction-1" id="toc-geometric-correction-1" class="nav-link" data-scroll-target="#geometric-correction-1"><span class="header-section-number">3.2.1</span> Geometric correction</a></li>
  <li><a href="#atmospheric-correction-1" id="toc-atmospheric-correction-1" class="nav-link" data-scroll-target="#atmospheric-correction-1"><span class="header-section-number">3.2.2</span> Atmospheric correction</a></li>
  </ul></li>
  <li><a href="#reflections" id="toc-reflections" class="nav-link" data-scroll-target="#reflections"><span class="header-section-number">3.3</span> Reflections</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Corrections</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="summary" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="summary"><span class="header-section-number">3.1</span> Summary</h2>
<p>Remotely sensed images sometimes may be flawed (due to the atmosphere, terrain, sensor, etc.) - there are various types of corrections that can be done and four of them - <em>geometric, atmospheric, orthorectification/topographic, and radiometric calibration</em> - will be discussed below.</p>
<section id="geometric-correction" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="geometric-correction"><span class="header-section-number">3.1.1</span> Geometric correction</h3>
<ol type="1">
<li><p>Identify Ground Control Points (GPS) to align identifiable points within the image with those in a reference dataset.</p></li>
<li><p>Derive geometric transformation coefficients by modeling the coordinates.</p></li>
<li><p>Next, we plot these points and aim to minimize the Root Mean Square Error (RMSE) (the model with the lowest RMSE will fit best), with Jensen defining a target RMSE value of 0.5.</p></li>
<li><p>Re-sampling the final raster is a must, methods are the following:</p>
<ol type="i">
<li>Nearest Neighbour</li>
<li>Linear</li>
<li>Cubic</li>
<li>Cubic spine</li>
</ol></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="geometric-correction.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Schematic Depiction of Geometric Correction <span class="citation" data-cites="ImageProcessing">(<a href="references.html#ref-ImageProcessing" role="doc-biblioref"><span>“Image <span>Processing</span>”</span> n.d.</a>)</span>.</figcaption>
</figure>
</div>
</section>
<section id="atmospheric-correction" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="atmospheric-correction"><span class="header-section-number">3.1.2</span> Atmospheric correction</h3>
<p>Atmospheric correction is necessary when data concerns biophysical parameters as well as when using spectral signatures over time and space.</p>
<section id="atmospheric-correction-types" class="level4" data-number="3.1.2.1">
<h4 data-number="3.1.2.1" class="anchored" data-anchor-id="atmospheric-correction-types"><span class="header-section-number">3.1.2.1</span> <strong>Atmospheric correction types</strong></h4>
<ol type="1">
<li><strong>Relative (to something)</strong>:
<ul>
<li><em>Dark object subtraction (DOS) or histogram adjustment</em>: scanning each band to identify the darkest value and then subtracting it from every pixel.</li>
<li><em>Pseudo-invariant Features (PIFs)</em>: assuming brightness pixels linearly relates to a base image - regression per band - modifying the image according to the regression outcome and applying this principle to the rest of the pixels.</li>
</ul></li>
<li><strong>Absolute</strong>:
<ul>
<li>Converting digital brightness values into scaled surface reflectance - allows for comparison of these scaled surface reflectance values globally and is achieved through atmospheric radiative transfer models.</li>
<li>Requirements: an atmospheric model, local atmospheric visibility, image altitude.</li>
</ul></li>
<li><strong>Empirical line correction</strong>:
<ul>
<li>Going in situ and using a field spectrometer.</li>
</ul></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="atmospheric-correction.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A true color composite (bands 4-3-2) of Sentinel-2B image with top-of-atmosphere (TOA) reflectance (left) and surface reflectance after atmospheric correction (right) with Land Surface Reflectance Code (LaSRC) <span class="citation" data-cites="AtmosphericCorrection">(<a href="references.html#ref-AtmosphericCorrection" role="doc-biblioref"><span>“Atmospheric Correction”</span> n.d.</a>)</span>.</figcaption>
</figure>
</div>
</section>
</section>
<section id="orthorectificationtopographic-correction" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="orthorectificationtopographic-correction"><span class="header-section-number">3.1.3</span> Orthorectification/topographic correction</h3>
<p>Orthorectification is the process of correcting image distortions caused by terrain variations, ensuring accurate geometric representation of Earth’s surface in remote sensing imagery i.e., as if viewed from nadir. It requires sensor geometry and an elevation model.</p>
<p><strong>Formulas to do this</strong>:</p>
<ul>
<li>Cosine correction</li>
<li>Minnaert correction</li>
<li>Statistical empirical correction</li>
<li>C correction</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="orthorectification.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><span class="citation" data-cites="setyawanOrthorectificationNutshell">(<a href="references.html#ref-setyawanOrthorectificationNutshell" role="doc-biblioref">Setyawan n.d.</a>)</span>.</figcaption>
</figure>
</div>
</section>
<section id="radiometric-calibration" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4" class="anchored" data-anchor-id="radiometric-calibration"><span class="header-section-number">3.1.4</span> Radiometric calibration</h3>
<p>Sensors capture image brightness and distribute it as a Digital Number (DN), enabling efficient storage, albeit lacking units. Radiometric calibration is essentially the process if transforming DN to spectral radiance, i.e.&nbsp;the amount of light within a band from a sensor in the field of view (FOV). The process of radiometric calibration is crucial in remote sensing to ensure accurate and consistent measurement of electromagnetic radiation, enabling reliable interpretation and analysis of remote sensing data.</p>
</section>
<section id="disclaimer---or-simply-good-news" class="level3" data-number="3.1.5">
<h3 data-number="3.1.5" class="anchored" data-anchor-id="disclaimer---or-simply-good-news"><span class="header-section-number">3.1.5</span> Disclaimer - or simply good news?</h3>
<p>Remote sensing products are now provided in a ‘corrected’ format, such as ‘Analysis Ready Data’ (ARD) i.e., there’s no need to apply these corrections manually, however, it is necessary to know how remotely sensed data was created.</p>
</section>
</section>
<section id="applications" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="applications"><span class="header-section-number">3.2</span> Applications</h2>
<p>The two types of corrections I found most interesting personally were geometric and atmospheric, hence, the applications section will be dedicated to reviewing examples of research papers that have utilised them.</p>
<section id="geometric-correction-1" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="geometric-correction-1"><span class="header-section-number">3.2.1</span> Geometric correction</h3>
<p><span class="citation" data-cites="kimGeometricCorrectionGeostationary2018">(<a href="references.html#ref-kimGeometricCorrectionGeostationary2018" role="doc-biblioref">Kim, Son, and Kim 2018</a>)</span> published a study aimed to improve the accuracy of satellite data from ocean color sensors, like the Geostationary Ocean Color Imager (GOCI), by developing a new method for geometric correction. This was a critical gap in research to fill because traditional methods based on ground control points (GCPs) were ineffective in areas where shorelines were absent, presenting a challenge for accurately aligning satellite images. The researchers used a combination of shoreline matching and frequency matching techniques to correct the images. Their findings showed that this new method significantly improved the accuracy of the satellite data, demonstrating the importance of geometric correction in producing reliable and high-quality images for various applications, such as monitoring ocean health and environmental changes.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="GOCI.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">GOCI slot imaging sequence <span class="citation" data-cites="kimGeometricCorrectionGeostationary2018">(<a href="references.html#ref-kimGeometricCorrectionGeostationary2018" role="doc-biblioref">Kim, Son, and Kim 2018</a>)</span>.</figcaption>
</figure>
</div>
</section>
<section id="atmospheric-correction-1" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="atmospheric-correction-1"><span class="header-section-number">3.2.2</span> Atmospheric correction</h3>
<p><span class="citation" data-cites="sriwongsitanonInfluenceAtmosphericCorrection2011">(<a href="references.html#ref-sriwongsitanonInfluenceAtmosphericCorrection2011" role="doc-biblioref">Sriwongsitanon, Surakit, and Thianpopirug 2011</a>)</span> carried out a study to investigate the impact of atmospheric correction and sampling point density on the precision of remote sensing in assessing lake water clarity. Field experiments were conducted at Bung Boraphet, the largest freshwater lake in Thailand, to gather data on clarity parameters and suspended sediment concentration. By applying atmospheric correction to satellite images, the authors identified substantial effects on the estimated values of water clarity parameters, the accuracy of which is crucial for assessing water quality, monitoring ecosystem health, and informing management decisions to protect freshwater resources.</p>
</section>
</section>
<section id="reflections" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="reflections"><span class="header-section-number">3.3</span> Reflections</h2>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-AtmosphericCorrection" class="csl-entry" role="listitem">
<span>“Atmospheric Correction.”</span> n.d. NASA. Accessed February 15, 2024. <a href="https://hls.gsfc.nasa.gov/algorithms/atmospheric-correction/">https://hls.gsfc.nasa.gov/algorithms/atmospheric-correction/</a>.
</div>
<div id="ref-ImageProcessing" class="csl-entry" role="listitem">
<span>“Image <span>Processing</span>.”</span> n.d. Science Education through Earth Observation for High Schools (SEOS). Accessed February 15, 2024. <a href="https://seos-project.eu/remotesensing/remotesensing-c05-p01.html">https://seos-project.eu/remotesensing/remotesensing-c05-p01.html</a>.
</div>
<div id="ref-kimGeometricCorrectionGeostationary2018" class="csl-entry" role="listitem">
Kim, Han-Gyeol, Jong-Hwan Son, and Taejung Kim. 2018. <span>“Geometric <span>Correction</span> for the <span>Geostationary Ocean Color Imager</span> from a <span>Combination</span> of <span>Shoreline Matching</span> and <span>Frequency Matching</span>.”</span> <em>Sensors</em> 18 (11): 3599. <a href="https://doi.org/10.3390/s18113599">https://doi.org/10.3390/s18113599</a>.
</div>
<div id="ref-setyawanOrthorectificationNutshell" class="csl-entry" role="listitem">
Setyawan, Eric. n.d. <span>“Orthorectification in a <span>Nutshell</span>.”</span> Intermap. Accessed February 15, 2024. <a href="https://www.intermap.com/blog/orthorectification-in-a-nutshell">https://www.intermap.com/blog/orthorectification-in-a-nutshell</a>.
</div>
<div id="ref-sriwongsitanonInfluenceAtmosphericCorrection2011" class="csl-entry" role="listitem">
Sriwongsitanon, Nutchanart, Kritsanat Surakit, and Sansarith Thianpopirug. 2011. <span>“Influence of Atmospheric Correction and Number of Sampling Points on the Accuracy of Water Clarity Assessment Using Remote Sensing Application.”</span> <em>Journal of Hydrology</em> 401 (3-4): 203–20. <a href="https://doi.org/10.1016/j.jhydrol.2011.02.023">https://doi.org/10.1016/j.jhydrol.2011.02.023</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Week_2.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Xarigan</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Week_4.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Policy</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>